<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>季節イベ最大スコア計算</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            // ネオングリーン系
            primary: {
              DEFAULT: '#10b981', // Emerald 500
              glow: '#34d399',    // Emerald 400
              dark: '#064e3b',    // Emerald 900
            },
          },
          fontFamily: {
            mono: ['"JetBrains Mono"', 'monospace'],
            sans: ['"Noto Sans JP"', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <style>
    /* 確実に黒背景にするための設定 */
    body {
      background-color: #050505; 
      background-image: radial-gradient(circle at 50% 0%, #064e3b 0%, #000000 70%);
      color: #e2e8f0;
      font-family: 'Noto Sans JP', sans-serif;
      min-height: 100vh;
    }

    /* --- 入力エリア --- */
    .dashboard-header {
      background: rgba(5, 5, 5, 0.85);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(16, 185, 129, 0.3);
      position: sticky;
      top: 0;
      z-index: 50;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    }

    .input-group {
      position: relative;
      background: rgba(20, 20, 20, 0.6);
      border-radius: 8px;
      padding: 8px 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s ease;
    }

    .input-group:focus-within {
      background: rgba(6, 78, 59, 0.6);
      border-color: #10b981;
      /* 緑のグロー */
      box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
    }

    .label-text {
      font-size: 0.7rem;
      color: #34d399; /* 明るい緑 */
      font-weight: 700;
      margin-bottom: 4px;
      letter-spacing: 0.05em;
    }

    .input-field {
      background: transparent;
      color: #f0fdf4;
      font-family: 'JetBrains Mono';
      font-size: 1.1rem;
      font-weight: 500;
      outline: none;
      width: 100%;
    }
    .input-field::placeholder { color: #475569; }

    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

    /* --- グリッドレイアウト --- */
    #gridContainer {
      display: grid;
      gap: 1px;
      background-color: #064e3b; /* 枠線の色 */
      border: 1px solid #064e3b;
      border-radius: 0 0 8px 8px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
    }

    /* --- 列ヘッダー --- */
    #headerRow {
      display: grid;
      gap: 1px;
      margin-bottom: 0;
      background-color: #064e3b;
      border: 1px solid #064e3b;
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      overflow: hidden;
    }
    .header-cell {
      text-align: center;
      background: #020617;
      color: #34d399;
      font-size: 0.75rem;
      font-weight: bold;
      padding: 8px 0;
      border-bottom: 2px solid #10b981;
    }

    /* --- セルデザイン --- */
    .cell {
      background-color: #0a0a0a; /* 基本の黒 */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 70px;
      position: relative;
      transition: background-color 0.2s;
    }
    .cell:hover {
      background-color: #1a1a1a;
    }

    /* バフ% (ヘッダー) */
    .cell-buff {
      width: 100%;
      text-align: center;
      /* 緑のグラデーション */
      background: linear-gradient(180deg, rgba(6, 78, 59, 0.8) 0%, rgba(5, 5, 5, 0) 100%);
      color: #ffffff;
      font-family: 'JetBrains Mono';
      font-size: 0.75rem;
      font-weight: bold;
      padding: 4px 0;
      border-bottom: 1px solid rgba(16, 185, 129, 0.2);
      margin-bottom: 4px;
    }

    /* 結果% (メイン) */
    .cell-result {
      color: #ffffff;
      font-family: 'JetBrains Mono';
      font-size: 1rem;
      font-weight: 700;
      line-height: 1.2;
      text-shadow: 0 0 10px rgba(16, 185, 129, 0.2);
    }

    /* ダメージ (サブ) */
    .cell-damage {
      color: #94a3b8;
      font-family: 'JetBrains Mono';
      font-size: 0.65rem;
      margin-top: 2px;
      font-weight: 500;
    }

    /* --- ハイライト (検索ヒット) --- */
    .highlight-cell {
      background-color: #050505 !important;
      /* 緑の発光 */
      box-shadow: inset 0 0 0 2px #34d399, 0 0 30px rgba(16, 185, 129, 0.4);
      z-index: 10;
    }
    
    .highlight-cell .cell-buff {
      background: #10b981;
      color: #ffffff;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
      border-bottom: none;
    }
    
    .highlight-cell .cell-result {
      color: #34d399;
      text-shadow: 0 0 15px rgba(16, 185, 129, 0.8);
    }
    .highlight-cell .cell-damage {
      color: #d1fae5; 
    }

    /* 空白セル */
    .cell-empty {
      background-color: #000000;
      opacity: 0.4;
    }
  </style>
</head>
<body class="flex flex-col items-center">

  <div class="dashboard-header w-full flex justify-center py-4 px-4">
    <div class="w-full max-w-6xl grid grid-cols-3 gap-4">
      
      <div class="input-group">
        <label class="label-text">相手HP</label>
        <input type="number" id="baseValueInput" value="100000000" class="input-field">
      </div>
      
      <div class="input-group">
        <label class="label-text">目標Pt(スコア)</label>
        <input type="number" id="adjustedValueInput" value="600000" class="input-field">
      </div>
      
      <div class="input-group" style="border-color: rgba(52, 211, 153, 0.3);">
        <label class="label-text" style="color: #34d399;">ボーナス検索 (%)</label>
        <input type="number" id="targetPercentInput" placeholder="-" class="input-field" style="color: #34d399;">
        <div class="absolute right-3 top-1/2 -translate-y-1/2 text-emerald-400/30 pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        </div>
      </div>

    </div>
  </div>

  <div class="w-full max-w-6xl pt-4 pb-12 px-2 sm:px-6">
    <div id="headerRow"></div>
    <div id="gridContainer"></div>
  </div>

  <script>
    const baseValueInput = document.getElementById('baseValueInput');
    const adjustedValueInput = document.getElementById('adjustedValueInput');
    const targetPercentInput = document.getElementById('targetPercentInput');
    const gridContainer = document.getElementById('gridContainer');
    const headerRow = document.getElementById('headerRow');

    const calculateResult = (baseValue, adjustedValue, percentage) => {
      const h6 = percentage / 100;
      const adjusted = (adjustedValue / (1 + h6) - 20000) / 280000;
      const result = Math.ceil(baseValue * adjusted);
      const percent = result / baseValue;
      
      return {
        percentStr: (percent * 100).toFixed(2) + '%',
        damageStr: new Intl.NumberFormat('ja-JP').format(result)
      };
    };

    const renderGrid = () => {
      gridContainer.innerHTML = '';
      headerRow.innerHTML = '';
      
      const baseValue = Number(baseValueInput.value);
      const adjustedValue = Number(adjustedValueInput.value);
      const targetPercent = targetPercentInput.value === '' ? -1 : Number(targetPercentInput.value);
      
      const isPC = window.innerWidth >= 768;
      const columns = isPC ? 10 : 5;

      gridContainer.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
      headerRow.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;

      const step = 100 / columns;
      for(let i = 0; i < columns; i++) {
        const div = document.createElement('div');
        div.className = 'header-cell';
        div.textContent = `${i * step}% ～`; 
        headerRow.appendChild(div);
      }

      const colRanges = [];
      for(let i=0; i<columns; i++) {
        const start = i * step;
        let end = start + step - 1;
        if(i === columns - 1) end = 100; 
        colRanges.push({ start, end });
      }

      const maxRows = isPC ? 11 : 21;

      for (let r = 0; r < maxRows; r++) {
        for (let c = 0; c < columns; c++) {
          
          const p = colRanges[c].start + r;
          
          if (p <= colRanges[c].end) {
            const data = calculateResult(baseValue, adjustedValue, p);
            const isHighlight = (p === targetPercent);

            const cell = document.createElement('div');
            cell.className = `cell ${isHighlight ? 'highlight-cell' : ''}`;
            
            cell.innerHTML = `
              <div class="cell-buff">${p}%</div>
              <div class="cell-result">${data.percentStr}</div>
              <div class="cell-damage">${data.damageStr}</div>
            `;
            
            gridContainer.appendChild(cell);
            
            if(isHighlight) {
              setTimeout(() => {
                cell.scrollIntoView({ behavior: 'smooth', block: 'center' });
              }, 100);
            }

          } else {
             const cell = document.createElement('div');
             cell.className = 'cell cell-empty';
             gridContainer.appendChild(cell);
          }
        }
      }
    };

    const handleInput = () => renderGrid();
    window.addEventListener('resize', renderGrid);
    
    baseValueInput.addEventListener('input', handleInput);
    adjustedValueInput.addEventListener('input', handleInput);
    targetPercentInput.addEventListener('input', handleInput);

    renderGrid();
  </script>
</body>
</html>